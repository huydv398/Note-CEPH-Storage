# LVM Snapshot
## Giới thiệu
LVM snapshot cung cấp tính năng cho phép tạo virtual images của thiết bị được chọn lập tức mà không làm gián đoạn các dịch vụ đang chạy.

Khi thay đổi được thực hiện sau khi thiết bị đã được snapshot, tính năng snapshot sẽ tạo bản copy khu vực, cho phép khôi phục khi cần.

Vì Snapshot chỉ sao chép phân vùng dữ liệu thay đổi sau khi snapshot được tạo => yêu cầu khối lượng lưu trữ nhỏ. VD: đối với dữ liệu ít được thay đổi, bản snap chỉ nặng từ 3-5% khi so sánh với phiên bản gốc.
## Chuẩn bị
Thiết lập máy ảo như sau:

![img](/image/img1.png)
## Phần 1: Tạo LVM Snapshot
Kiểm tra thông số trước khi cấu hình
```
[root@srv ~]# pvs
  PV         VG     Fmt  Attr PSize   PFree
  /dev/sda2  centos lvm2 a--  <19.00g     0
  /dev/sdb1  test   lvm2 a--   <5.00g <4.00g
  /dev/sdc1  test   lvm2 a--   <5.00g <5.00g
  /dev/sdd1         lvm2 ---   <5.00g <5.00g
[root@srv ~]# vgs
  VG     #PV #LV #SN Attr   VSize   VFree
  centos   1   2   0 wz--n- <19.00g    0
  test     2   1   0 wz--n-   9.99g 8.99g
[root@srv ~]# lvs
  LV      VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root    centos -wi-ao---- <17.00g
  swap    centos -wi-ao----   2.00g
  lv-test test   -wi-a-----   1.00g

```
### Tạo LV
```
# lvcreate -L 1G -n store-1 test
```
* `-L 1G`: Tạo logical volume dung lượng 1g 
* `-n` -name: Đặt tên cho logical volume
* `test`: Tên volume group
![img](/image/Screenshot_33.png)</br>
### Tạo Snapshot cho LV vừa tạo
```
# lvcreate -L 1GB -s -n store-1_snap /dev/test/store-1
```
* Cú pháp: `lvcreate -L [Size] -s -n [Tên] [Snapshot cho LV]`
* `-s` – Tạo Snapshot
* `-n` – Tên cho snapshot

![img](/image/Screenshot_34.png)</br>
### Kiểm tra snapshot vừa tạo
```
# lvs
```
![img](/image/Screenshot_35.png)</br>
### Xoá Snapshot vừa Tạo
```
# lvremove /dev/test/store-1_snap
```

![img](/image/Screenshot_36.png)</br>

## Kiểm chứng (Thêm dữ liệu và kiểm tra thông số thay đổi)
### Thêm định dạng, mount vào OS, kiểm tra
```
# mkfs -t ext4 /dev/data-store/store-1
```

![img](/image/Screenshot_37.png)</br>
```
# mount /dev/test/store-1 /root/demo1
# df -h
```

![img](/image/Screenshot_38.png)</br>


![img](/image/Screenshot_39.png)</br>
![img](/image/Screenshot_40.png)</br>
![img](/image/Screenshot_41.png)</br>
![img](/image/Screenshot_42.png)</br>
![img](/image/Screenshot_43.png)</br>
![img](/image/Screenshot_44.png)</br>
![img](/image/Screenshot_45.png)</br>
![img](/image/Screenshot_46.png)</br>
![img](/image/Screenshot_47.png)</br>
![img](/image/Screenshot_48.png)</br>
![img](/image/Screenshot_49.png)</br>
![img](/image/Screenshot_50.png)</br>
![img](/image/Screenshot_51.png)</br>
![img](/image/Screenshot_52.png)</br>
![img](/image/Screenshot_53.png)</br>
![img](/image/Screenshot_54.png)</br>
![img](/image/Screenshot_55.png)</br>
![img](/image/Screenshot_56.png)</br>
![img](/image/Screenshot_57.png)</br>
![img](/image/Screenshot_58.png)</br>
![img](/image/Screenshot_59.png)</br>
![img](/image/Screenshot_60.png)</br>
![img](/image/Screenshot_61.png)</br>
![img](/image/Screenshot_62.png)</br>
![img](/image/Screenshot_63.png)</br>
![img](/image/Screenshot_64.png)</br>
![img](/image/Screenshot_65.png)</br>
![img](/image/Screenshot_66.png)</br>
![img](/image/Screenshot_67.png)</br>
![img](/image/Screenshot_68.png)</br>
![img](/image/Screenshot_69.png)</br>
![img](/image/Screenshot_70.png)</br>
![img](/image/Screenshot_71.png)</br>
![img](/image/Screenshot_72.png)</br>
![img](/image/Screenshot_73.png)</br>
![img](/image/Screenshot_74.png)</br>
![img](/image/Screenshot_75.png)</br>
![img](/image/Screenshot_76.png)</br>
![img](/image/Screenshot_77.png)</br>
![img](/image/Screenshot_78.png)</br>
![img](/image/Screenshot_79.png)</br>
![img](/image/Screenshot_80.png)</br>
![img](/image/Screenshot_81.png)</br>
![img](/image/Screenshot_82.png)</br>